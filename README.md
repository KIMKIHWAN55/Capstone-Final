프로젝트명 : ESN과 유전 알고리즘을 활용한 하이브리드 주가 예측 모델
금융 시계열 데이터는 노이즈가 심하고 비선형적이라 예측이 참 어렵습니다. 기존의 고정된 기술적 지표나 단순 딥러닝 모델만으로는 급변하는 시장 상황(Regime)에 유연하게 대처하기 힘들다는 문제의식에서 이 프로젝트를 시작했습니다.

이 프로젝트는 CPM(Critical Point Method)으로 노이즈를 걷어내고, 유전 알고리즘(GA)으로 최적화된 지표를 **ESN(Echo State Network)**에 학습시켜, 수익률뿐만 아니라 위험(MDD)까지 관리하는 안정적인 자동 매매 시스템을 구현한 결과물입니다.

아이디어: 
진짜 추세만보기 (CPM 도입): 주가의 자잘한 등락(Noise)에 모델이 휘둘리지 않도록, CPM 알고리즘을 통해 의미 있는 전환점(Turning Point)만 추출하여 학습 레이블(Label)로 사용했습니다.

상황에 맞는 지표찾기 (GA 최적화): RSI 14일, 이동평균 20일 같은 고정된 값을 쓰지 않습니다. 유전 알고리즘을 통해 현재 시장 데이터에 가장 적합한 지표 파라미터를 동적으로 찾아냅니다.

수익률 방어 (Risk-adjusted Fitness): 단순히 수익률만 높은 모델은 하락장에서 무너지기 쉽습니다. 모델 학습 시 SQN과 MDD를 고려한 적합도 함수를 사용하여, 하락장에서도 잘 버티는 모델을 만드는 데 집중했습니다.

시스템 파이프라인 : 
1. 전처리 & 레이블링 (CPM2.py):주가 데이터에서 국소 고점/저점을 찾고, 진폭($P$)과 기간($T$) 조건을 만족하는 유효한 파동만 남깁니다.이를 통해 매수/매도 시점(Target)을 정의합니다.
2. 지표 최적화 (MovingAverage3.py, RSI3.py, ROC3.py):
CPM이 정의한 정답지와 가장 유사한 신호를 내도록 기술적 지표들의 파라미터를 유전 알고리즘으로 튜닝합니다.
모델 학습 및 예측 (ESN_Signals5.py, CV_ESN7.py):
최적화된 지표들을 ESN의 입력으로 넣습니다.
Rolling Forward Cross-Validation 방식을 적용해 미래 데이터를 미리 참조(Look-ahead Bias)하는 문제를 원천 차단하고, 시계열 흐름에 따라 검증을 수행합니다.

파일 구성 : 
CV_ESN7.py: 메인 실행 파일입니다. 롤링 포워드 교차 검증을 수행하고 전체 파이프라인을 총괄합니다.
CPM2.py: 노이즈를 필터링하고 추세 전환점을 찾는 CPM 알고리즘 구현체입니다.
ESN_Signals5.py: pyESN을 활용해 ESN 모델을 구성하고 매매 신호를 생성하는 로직입니다.
MovingAverage3.py, RSI3.py, ROC3.py: 각 기술적 지표 생성 및 GA 최적화 모듈입니다.
eval_signal3.py: GA가 얼마나 잘 학습했는지 평가하는 적합도(Fitness) 함수가 들어있습니다.
example.ipynb: yfinance로 데이터를 받아와서 실제로 돌려볼 수 있는 예제 노트북입니다.

실행방법 : 
실행 (Jupyter Notebook) example.ipynb 파일을 열어서 실행하면 가장 간편합니다. 종목 코드만 바꾸면 다른 주식에도 적용해볼 수 있습니다.

Python

import yfinance as yf
from CV_ESN7 import esn_rolling_forward

 예: 존슨앤존슨(JNJ) 데이터 가져오기
df = yf.Ticker("JNJ").history(start='2015-07-22', end='2025-07-22')

 롤링 포워드 검증 실행
best_params, returns = esn_rolling_forward(
    df=df,
    n_splits=5,        # 5개 구간으로 나누어 검증
    pop_size=30,       # 유전 알고리즘 개체 수
    num_generations=30 # 진화 세대 수
)
실험 결과 요약
나스닥 상장 기업들을 대상으로 10년 치(2015~2025) 데이터를 돌려본 결과입니다.

하락장 방어력: 단순 존버(Buy & Hold) 전략이 큰 손실을 볼 때, 이 모델은 손실을 최소화하거나 오히려 수익을 내는 모습을 보였습니다.

XGBoost와 비교: 머신러닝의 강자 XGBoost와 비교했을 때도 수익률과 MDD 관리 측면에서 더 나은 성과(Risk-adjusted Return)를 기록했습니다.

한계점: 다만, 워낙 안전 지향적으로 학습되다 보니 미친듯이 오르는 강한 상승장에서는 수익률이 시장 평균보다 조금 낮게 나오는 경향이 있었습니다.

앞으로 개선점 : 
장 변동성에 따라 CPM 임계값($P, T$)이 알아서 조절되도록 개선 (Dynamic Thresholding)상승장/하락장 국면을 먼저 판단하고, 그에 맞춰 공격적/방어적 모드로 전환하는 적응형 시스템 개발트레일링 스탑(Trailing Stop) 같은 시스템적 손절매 로직 추가

프로젝트 참여자 문민중, 김기환, 오수현, 정파랑
